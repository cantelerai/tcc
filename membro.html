<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>√Årea do Membro</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="page-header">
    <h2> √Årea do Membro</h2>
    <div class="pill-group">
      <span id="userPill" class="pill"></span>
      <button class="btn ghost" onclick="logout()">Sair</button>
    </div>
  </header>

  <main class="container-page">
    <div class="grid">
      <!-- Eventos -->
      <div class="card">
        <h3>üìÖ Pr√≥ximos Eventos</h3>
        <input id="searchEvents" type="text" placeholder="Buscar por t√≠tulo ou pregador..." style="margin-top:10px;padding:10px;border-radius:8px;width:100%;border:1px solid #eee;">
        <div id="eventsList" class="list mt-8"></div>
      </div>

      <!-- Minha Escala + Vers√≠culo -->
      <aside>
        <div class="card">
          <h3>üóìÔ∏è Minha Escala</h3>
          <div id="myScaleList" class="list mt-8"></div>
        </div>

        <div class="card mt-8">
          <h3>üìñ Vers√≠culo</h3>
          <div class="verse-box">
            <div id="verseRef" class="verse-ref"></div>
            <div id="verseText" class="verse-text"></div>
          </div>
          <div class="row mt-8">
            <button class="btn ghost small" id="prevVerseBtn">Anterior</button>
            <button class="btn small" id="nextVerseBtn">Pr√≥ximo vers√≠culo</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <script>
  /* ---------- constantes e store ---------- */
  const USER_KEY = "igrejaAppUser_v1";
  const STORE_KEY = "igrejaAppData_v3";

  function loadStore(){
    const raw = localStorage.getItem(STORE_KEY);
    if(!raw){
      const seed = {
        eventos: [
          { id:1, titulo:"Culto de Jovens", data:"2025-09-05", pregador:"Pr. Jo√£o" },
          { id:2, titulo:"Estudo B√≠blico", data:"2025-09-08", pregador:"Irm√£ Maria" }
        ],
        membros: [
          { id:1, nome:"Raiany", tipo:"membro" },
          { id:2, nome:"Ana", tipo:"membro" },
          { id:3, nome:"Paulo", tipo:"lider" }
        ],
        escalas: [
          { id:1, membroId:1, tarefa:"Louvor", data:"2025-09-05" }
        ],
        verses: [
          { id:1, ref:"Salmos 23:1", text:"O Senhor √© o meu pastor; nada me faltar√°." },
          { id:2, ref:"Filipenses 4:13", text:"Posso todas as coisas naquele que me fortalece." }
        ],
        nextIds: { evento:3, membro:4, escala:2, verse:3 }
      };
      localStorage.setItem(STORE_KEY, JSON.stringify(seed));
      return seed;
    }
    return JSON.parse(raw);
  }
  function saveStore(){ localStorage.setItem(STORE_KEY, JSON.stringify(store)); }
  let store = loadStore();

  /* ---------- sess√£o ---------- */
  const user = JSON.parse(localStorage.getItem(USER_KEY) || "null");
  if(!user){ alert("Fa√ßa login primeiro."); location.href="index.html"; }
  document.getElementById("userPill").textContent = `${user.name} ‚Ä¢ ${user.role}`;

  /* ---------- Eventos ---------- */
  const eventsListEl = document.getElementById("eventsList");
  const searchEventsEl = document.getElementById("searchEvents");
  searchEventsEl.addEventListener("input", renderEvents);

  function renderEvents(){
    const q = searchEventsEl.value.trim().toLowerCase();
    eventsListEl.innerHTML = "";
    const eventos = store.eventos.slice().sort((a,b)=> a.data.localeCompare(b.data)).filter(e=>{
      return !q || e.titulo.toLowerCase().includes(q) || e.pregador.toLowerCase().includes(q);
    });
    if(eventos.length===0){
      eventsListEl.innerHTML = `<div class="muted">Nenhum evento encontrado.</div>`;
      return;
    }
    eventos.forEach(ev=>{
      const div = document.createElement("div");
      div.className = "card-item";
      div.innerHTML = `<div class="item-main"><div class="item-title">${ev.titulo}</div><div class="item-sub">Data: ${ev.data} ‚Ä¢ Pregador: ${ev.pregador}</div></div><div class="item-actions"></div>`;
      eventsListEl.appendChild(div);
    });
  }

  /* ---------- Minha Escala ---------- */
  const myScaleListEl = document.getElementById("myScaleList");
  function renderMyScale(){
    myScaleListEl.innerHTML = "";
    const foundMember = store.membros.find(m => m.nome.toLowerCase() === user.name.toLowerCase());
    if(!foundMember){
      myScaleListEl.innerHTML = `<div class="muted">Seu nome n√£o est√° cadastrado. Pe√ßa a um(a) l√≠der para te adicionar.</div>`;
      return;
    }
    const myEscalas = store.escalas.filter(s => s.membroId === foundMember.id);
    if(myEscalas.length === 0){
      myScaleListEl.innerHTML = `<div class="muted">Voc√™ ainda n√£o tem escala.</div>`;
      return;
    }
    myEscalas.forEach(s=>{
      const d = document.createElement("div");
      d.className = "card-item";
      d.innerHTML = `<div class="item-main"><div class="item-title">${s.tarefa}</div><div class="item-sub">Data: ${s.data || '‚Äî'}</div></div>`;
      myScaleListEl.appendChild(d);
    });
  }

  /* ---------- Vers√≠culos ---------- */
  const verseRefEl = document.getElementById("verseRef");
  const verseTextEl = document.getElementById("verseText");
  let currentVerseIndex = 0;

  function renderVerse(index){
    if(!store.verses || store.verses.length===0){
      verseRefEl.textContent = "";
      verseTextEl.textContent = "Nenhum vers√≠culo cadastrado.";
      return;
    }
    if(index === undefined) index = Math.floor(Math.random()*store.verses.length);
    currentVerseIndex = index % store.verses.length;
    const v = store.verses[currentVerseIndex];
    verseRefEl.textContent = v.ref;
    verseTextEl.textContent = v.text;
  }

  document.getElementById("nextVerseBtn").addEventListener("click", ()=> renderVerse((currentVerseIndex+1)%store.verses.length));
  document.getElementById("prevVerseBtn").addEventListener("click", ()=> renderVerse((currentVerseIndex-1+store.verses.length)%store.verses.length));

  /* ---------- logout ---------- */
  function logout(){ localStorage.removeItem(USER_KEY); location.href="index.html"; }
  window.logout = logout;

  /* ---------- inicializa√ß√£o ---------- */
  renderEvents();
  renderMyScale();
  renderVerse();
  </script>
</body>
</html>
